import{H as v}from"./HeaderComponent-DlW0KALf.js";import{L as y}from"./LoadingComponent-JXivZofG.js";import{_ as k,r as _,o as r,a as l,g as d,e as t,F as b,b as V,t as h,w as f,x as L,f as p}from"./index-BqzZx0C6.js";const w={components:{HeaderComponent:v,LoadingComponent:y},data(){return{isLoading:!1,carts:[],total:0,finalTotal:0,code:"",isChange:!1}},inject:["toast"],methods:{getCarts(){this.isLoading=!0,this.axios.get("https://vue3-course-api.hexschool.io//v2/api/rongapi/cart").then(s=>{this.isLoading=!1,s.data.success?(this.finalTotal=s.data.data.final_total,this.total=s.data.data.total,this.carts=s.data.data.carts):this.toast("error","尚未抓到資料")}).catch(s=>{this.isLoading=!1,this.toast("error","尚未抓到資料"),console.error("cart-getCarts error",s)})},couponSubmit(){this.axios.post("https://vue3-course-api.hexschool.io//v2/api/rongapi/coupon",{data:{code:this.code}}).then(s=>{s.data.success?(this.toast("success","已更新商品價格"),this.getCarts()):this.toast("error","輸入錯誤")}).catch(s=>{this.toast("error","輸入錯誤"),console.error("cart-couponSubmit error",s)})},removeCart(a){const s=`https://vue3-course-api.hexschool.io//v2/api/rongapi/cart/${a}`;this.axios.delete(s).then(c=>{c.data.success?(this.getCarts(),this.isChangeCarts()):this.toast("error","失敗，請重新操作")}).catch(c=>{this.toast("error","失敗，請重新操作"),console.error("cart-removeCart error",c)})},count(a,s,c){let i=s;if(c===!0?i++:i--,i>=10||i<=0)return;const o=`https://vue3-course-api.hexschool.io//v2/api/rongapi/cart/${a}`;this.axios.put(o,{data:{product_id:a,qty:i}}).then(n=>{n.data.success?(this.getCarts(),this.isChangeCarts()):this.toast("error","失敗，請重新操作")}).catch(n=>{this.toast("error","失敗，請重新操作"),console.error("cart-removeCart error",n)})},isChangeCarts(){this.isChange===!1?this.isChange=!0:this.isChange=!1}},created(){this.getCarts()}},S={key:0,class:"has-header-layout"},q=L('<section class="d-flex justify-content-center pt-80 pb-40"><div class="p-2 p-lg-20 text-center border-dark me-2 bg-secondary"><h3 class="fs-md-6 m-0 text-uppercase fw-bold">Step1</h3><h5 class="fs-md-6 m-0 pt-4">確認訂單</h5></div><div class="p-2 p-lg-20 text-center border-dark me-2 bg-dark text-light opacity-50"><h3 class="fs-md-6 m-0 text-uppercase fw-bold">Step2</h3><h5 class="fs-md-6 m-0 pt-4">填寫資料</h5></div><div class="p-2 p-lg-20 text-center border-dark bg-dark text-light opacity-50"><h3 class="fs-md-6 m-0 text-uppercase fw-bold">Step3</h3><h5 class="fs-md-6 m-0 pt-4">交易結果</h5></div></section>',1),$={class:"container pb-40 pb-lg-80"},F={class:"row"},T=t("div",{class:"col-12 col-lg-2"},null,-1),N={class:"col-12 col-lg-8"},j={class:"table-responsive text-nowrap scrollBar-dark"},B={class:"table align-middle text-center"},H=t("thead",null,[t("tr",{class:"table-dark"},[t("th",{scope:"col"},"商品圖片"),t("th",{scope:"col"},"品名"),t("th",{scope:"col"},"價格"),t("th",{scope:"col"},"數量"),t("th",{scope:"col"},"操作")])],-1),U=t("br",null,null,-1),D=["src","alt"],E={class:"d-inline-block"},M={class:"d-flex border border-2 border-dark"},z=["onClick"],A=t("span",{class:"material-symbols-outlined fs-6"}," remove ",-1),G=[A],I={class:"px-2 d-flex justify-content-center align-items-center"},J=["onClick"],K=t("span",{class:"material-symbols-outlined fs-6"}," add",-1),O=[K],P=["onClick"],Q={key:0,colspan:"5",class:"text-end"},R={key:1,colspan:"5",class:"text-end"},W={colspan:"4",class:"border-0 text-start px-0"},X={class:"d-inline-block"},Y={class:"d-flex align-items-center bg-white"},Z=t("button",{type:"submit",class:"d-flex bg-transparent border-0"},[t("span",{class:"material-symbols-outlined fs-6"},"add")],-1),tt={colspan:"1",class:"border-0 text-end px-0"},st=t("tr",{class:"px-0 text-start"},[t("span",{class:"p-0"},"首購族優惠碼：first5off")],-1),et=t("div",{class:"col-12 col-lg-2"},null,-1),ot={key:1,class:"has-header-layout d-flex justify-content-center align-items-center text-center"},at=t("p",null,[p(" 您尚未選購商品"),t("br"),p(" 現在首購可有5折優惠"),t("br"),p("趕快去購買吧~~~ "),t("br"),t("br"),p(" 首購族優惠碼：first5off ")],-1),nt=[at];function rt(a,s,c,i,o,n){const g=_("HeaderComponent"),x=_("LoadingComponent"),m=_("VField"),C=_("VForm");return r(),l(b,null,[d(g),d(x,{isLoading:o.isLoading},null,8,["isLoading"]),o.carts.length>=1?(r(),l("main",S,[q,t("section",$,[t("div",F,[T,t("div",N,[t("div",j,[t("table",B,[H,U,t("tbody",null,[(r(!0),l(b,null,V(o.carts,e=>(r(),l("tr",{key:e.id},[t("th",null,[t("img",{src:e.product.imageUrl,alt:e.id,width:"150",class:"img-fluid"},null,8,D)]),t("td",null,h(e.product.title),1),t("td",null,"NT$ "+h(e.product.price),1),t("td",null,[t("div",E,[t("div",M,[t("button",{type:"button",class:"btn btn-outline-dark border-0",onClick:u=>n.count(e.id,e.qty,!1)},G,8,z),t("div",I,[d(m,{name:"number",type:"number",modelValue:e.qty,"onUpdate:modelValue":u=>e.qty=u,rules:"required",ref_for:!0,ref:"count"},{default:f(()=>[p(h(e.qty),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),t("button",{type:"button",class:"btn btn-outline-dark border-0",onClick:u=>n.count(e.id,e.qty,!0)},O,8,J)])])]),t("td",null,[t("button",{type:"button",class:"btn-close",onClick:u=>n.removeCart(e.id)},null,8,P)])]))),128))]),t("tfoot",null,[t("tr",null,[o.finalTotal!==o.total?(r(),l("td",Q," 折扣後金額："+h(Math.round(o.finalTotal)),1)):(r(),l("td",R," 總金額："+h(o.total),1))]),t("tr",null,[t("td",W,[d(C,{onSubmit:n.couponSubmit},{default:f(()=>[t("div",X,[t("div",Y,[d(m,{type:"text",name:"coupon",class:"form-control w-auto border-0 bg-transparent",placeholder:"請輸入折價卷碼","aria-label":"請輸入折價卷碼",modelValue:o.code,"onUpdate:modelValue":s[0]||(s[0]=e=>o.code=e)},null,8,["modelValue"]),Z])])]),_:1},8,["onSubmit"])]),t("td",tt,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[1]||(s[1]=e=>a.$router.push({name:"pay"}))}," 下一步 ")])]),st])])])]),et])])])):(r(),l("main",ot,nt))],64)}const dt=k(w,[["render",rt]]);export{dt as default};
